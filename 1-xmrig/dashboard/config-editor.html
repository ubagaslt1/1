<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XMRig Configuration Editor</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-cogs"></i> XMRig Configuration Editor</h1>
            <div class="subtitle">Edit and manage your mining configuration</div>
        </header>

        <div class="card">
            <div class="editor-controls">
                <button onclick="loadConfig()" class="btn btn-primary">
                    <i class="fas fa-sync"></i> Load Current Configuration
                </button>
                <button onclick="saveConfig()" class="btn btn-success">
                    <i class="fas fa-save"></i> Save & Apply Changes
                </button>
                <button onclick="resetConfig()" class="btn btn-warning">
                    <i class="fas fa-undo"></i> Reset to Defaults
                </button>
                <button onclick="downloadConfig()" class="btn btn-info">
                    <i class="fas fa-download"></i> Download Config
                </button>
                <input type="file" id="configUpload" accept=".json" style="display:none">
                <button onclick="uploadConfig()" class="btn btn-secondary">
                    <i class="fas fa-upload"></i> Upload Config File
                </button>
            </div>
            
            <div class="editor-container">
                <textarea id="configEditor" spellcheck="false" placeholder="Loading configuration..."></textarea>
                <div class="editor-info">
                    <p><i class="fas fa-info-circle"></i> Edit the JSON configuration above. Click "Save & Apply" to restart XMRig with new settings.</p>
                    <p><i class="fas fa-exclamation-triangle"></i> Warning: Invalid JSON will not be saved. The miner will restart when saving.</p>
                </div>
            </div>
            
            <div class="quick-actions" style="margin-top: 20px;">
                <h3><i class="fas fa-bolt"></i> Quick Configuration Templates</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                    <button onclick="applyTemplate('monero')" class="btn btn-primary">
                        <i class="fas fa-coins"></i> Monero (RandomX)
                    </button>
                    <button onclick="applyTemplate('medium')" class="btn btn-primary">
                        <i class="fas fa-sliders-h"></i> Medium Intensity
                    </button>
                    <button onclick="applyTemplate('light')" class="btn btn-primary">
                        <i class="fas fa-leaf"></i> Light Weight
                    </button>
                    <button onclick="applyTemplate('donate')" class="btn btn-warning">
                        <i class="fas fa-heart"></i> 5% Donation
                    </button>
                </div>
            </div>
        </div>

        <div class="card">
            <h2><i class="fas fa-question-circle"></i> Configuration Help</h2>
            
            <div class="help-sections">
                <div class="help-section">
                    <h3>Basic Settings</h3>
                    <ul>
                        <li><strong>pools[0].user</strong>: Your Monero wallet address</li>
                        <li><strong>pools[0].url</strong>: Mining pool URL (e.g., pool.supportxmr.com:443)</li>
                        <li><strong>pools[0].pass</strong>: Worker password (can be 'x')</li>
                        <li><strong>donate-level</strong>: Developer donation percentage (1-5 recommended)</li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h3>CPU Settings</h3>
                    <ul>
                        <li><strong>cpu.enabled</strong>: Enable/disable CPU mining</li>
                        <li><strong>cpu.huge-pages</strong>: Improves RandomX performance</li>
                        <li><strong>cpu.priority</strong>: Process priority (null for auto)</li>
                        <li><strong>cpu.threads</strong>: Adjust in the "rx" array for RandomX</li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h3>API Settings</h3>
                    <ul>
                        <li><strong>api.port</strong>: API port (default: 18080)</li>
                        <li><strong>api.access-token</strong>: API authentication token</li>
                        <li><strong>api.restricted</strong>: Restrict API access</li>
                    </ul>
                </div>
            </div>
        </div>

        <footer>
            <p>XMRig Configuration Editor | Official XMRig v6.25.0</p>
            <p class="small">Changes take effect after miner restart. Monitor logs for any issues.</p>
        </footer>
    </div>

    <script src="dashboard.js"></script>
    <script>
        // Configuration templates
        const configTemplates = {
            monero: {
                "pools": [{
                    "url": "pool.supportxmr.com:443",
                    "user": "YOUR_WALLET_ADDRESS_HERE",
                    "pass": "x",
                    "rig-id": "umbrel",
                    "keepalive": true,
                    "tls": true
                }],
                "cpu": {
                    "enabled": true,
                    "huge-pages": true,
                    "hw-aes": null,
                    "priority": null,
                    "memory-pool": false,
                    "yield": true,
                    "asm": true,
                    "rx": [0, 2]
                },
                "donate-level": 1
            },
            
            medium: {
                "cpu": {
                    "rx": [0, 1],
                    "cn": [[1, 0]],
                    "cn-lite": [[1, 0]]
                },
                "print-time": 120,
                "health-print-time": 120,
                "retries": 3,
                "retry-pause": 10
            },
            
            light: {
                "cpu": {
                    "rx": [0],
                    "cn": [[1, 0]],
                    "cn-lite": [[1, 0]]
                },
                "print-time": 300,
                "health-print-time": 300,
                "donate-level": 0
            },
            
            donate: {
                "donate-level": 5,
                "donate-over-proxy": 5
            }
        };

        function applyTemplate(templateName) {
            if (!configTemplates[templateName]) {
                showNotification('Template not found', 'error');
                return;
            }
            
            try {
                const editor = document.getElementById('configEditor');
                if (!editor || !editor.value) return;
                
                let config = JSON.parse(editor.value);
                
                // Deep merge template
                function deepMerge(target, source) {
                    for (const key in source) {
                        if (source[key] && typeof source[key] === 'object' && !Array.isArray(source[key])) {
                            if (!target[key] || typeof target[key] !== 'object') {
                                target[key] = {};
                            }
                            deepMerge(target[key], source[key]);
                        } else {
                            target[key] = source[key];
                        }
                    }
                    return target;
                }
                
                config = deepMerge(config, configTemplates[templateName]);
                editor.value = JSON.stringify(config, null, 2);
                
                showNotification(`Applied ${templateName} template`, 'success');
            } catch (error) {
                showNotification('Error applying template: ' + error.message, 'error');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadConfig();
        });
    </script>
</body>
</html>
